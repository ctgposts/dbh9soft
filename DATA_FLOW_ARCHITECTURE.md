# 🔄 ডেটা ফ্লো আর্কিটেকচার

## POS থেকে Dashboard পর্যন্ত সম্পূর্ণ ফ্লো

### 1️⃣ POS লেনদেন প্রক্রিয়া

```
┌─────────────────────────────────┐
│  গ্রাহক পিওএস এ পণ্য যোগ করে   │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ PRODUCTS ডাটাবেস থেকে              │
│ - পণ্যের বিবরণ                    │
│ - মূল্য                           │
│ - স্টক লেভেল                     │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ DISCOUNTS চেক করা               │
│ - প্রযোজ্য ছাড়                 │
│ - কুপন যাচাইকরণ                 │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ CUSTOMERS ডাটাবেস               │
│ - গ্রাহক তথ্য                   │
│ - লয়্যালটি পয়েন্ট               │
│ - ক্রেডিট সীমা                   │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ SALES ডাটাবেসে সংরক্ষণ করা      │
│ ✅ লেনদেন রেকর্ড                 │
│ ✅ আইটেম বিবরণ                  │
│ ✅ লেনদেন সময়                   │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ INVENTORY আপডেট                 │
│ - স্টক হ্রাস                     │
│ - পুনঃঅর্ডার সতর্কতা             │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ CUSTOMER LOYALTY আপডেট           │
│ - পয়েন্ট যোগ                   │
│ - স্তর পরিবর্তন                 │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ Dashboard রিয়েল-টাইম আপডেট     │
│ ✅ বিক্রয় সংখ্যা বৃদ্ধি          │
│ ✅ রাজস্ব গণনা                  │
│ ✅ স্টক গ্রাফ আপডেট             │
└─────────────────────────────────┘
```

---

### 2️⃣ রিফান্ড প্রক্রিয়া ফ্লো

```
┌──────────────────────────────┐
│  গ্রাহক রিফান্ড অনুরোধ করে    │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ SALES ডাটাবেস থেকে সার্চ করা   │
│ - লেনদেন রেকর্ড খুঁজুন         │
│ - আইটেম বিবরণ যাচাই করুন      │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ নীতি চেক করা                  │
│ - রিফান্ড সময়সীমা             │
│ - প্রযোজ্য কারণ               │
│ - সর্বোচ্চ রিফান্ড পরিমাণ      │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ REFUNDS রেকর্ড তৈরি করা       │
│ ✅ রিফান্ড আবেদন সংরক্ষণ       │
│ ✅ কারণ ডকুমেন্ট              │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ স্বয়ংক্রিয় অনুমোদন (যোগ্য   │
│ শর্ত পূরণ করলে)            │
│ ✅ বা ম্যানুয়াল পর্যালোচনা   │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ REFUND AUDIT TRAIL লগ        │
│ - তারিখ এবং সময়             │
│ - অনুমোদনকারী                 │
│ - আইটেম বিবরণ               │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ INVENTORY পুনরুদ্ধার          │
│ - স্টক যোগ করা              │
│ - কোয়ান্টিটি আপডেট          │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ CUSTOMER LOYALTY বিপরীত     │
│ - পয়েন্ট কেটে ফেলা          │
│ - সম্ভাব্য ছাড় রিভার্স        │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ TRANSACTIONS রেকর্ড          │
│ - রিফান্ড লেনদেন              │
│ - ব্যাংক বিশদ               │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ Dashboard আপডেট             │
│ ✅ রিফান্ড সংখ্যা বৃদ্ধি      │
│ ✅ রাজস্ব সমন্বয়            │
│ ✅ ট্রেন্ড পরিবর্তন           │
└──────────────────────────────┘
```

---

### 3️⃣ স্টক ট্রান্সফার প্রক্রিয়া

```
┌────────────────────────────────┐
│  Branch A থেকে Branch B তে     │
│  স্টক ট্রান্সফার অনুরোধ       │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ INVENTORY যাচাই করা           │
│ - সোর্স স্টক উপলব্ধ           │
│ - গন্তব্য ক্ষমতা             │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ STOCK TRANSFERS রেকর্ড তৈরি     │
│ - স্থানান্তর বিবরণ সংরক্ষণ    │
│ - পণ্য এবং পরিমাণ            │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ অনুমোদন কর্মপ্রবাহ            │
│ - ম্যানেজার পর্যালোচনা        │
│ - অনুমোদন বা প্রত্যাখ্যান      │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ INVENTORY সিঙ্ক্রোনাইজেশন    │
│ - সোর্স: স্টক হ্রাস           │
│ - গন্তব্য: স্টক বৃদ্ধি        │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ STOCK MOVEMENTS লগিং          │
│ - স্থানান্তরের সম্পূর্ণ ট্রেইল │
│ - অডিট ট্রেইল                │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ Dashboard আপডেট              │
│ ✅ শাখা-ভিত্তিক স্টক সিঙ্ক     │
│ ✅ ট্রান্সফার ট্র্যাকিং        │
└────────────────────────────────┘
```

---

### 4️⃣ গ্রাহক লয়্যালটি ফ্লো

```
┌──────────────────────────────┐
│  গ্রাহক ক্রয় করলে            │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ CUSTOMERS লুক আপ             │
│ - গ্রাহক আইডি খুঁজুন         │
│ - বর্তমান স্তর চেক করুন       │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ পয়েন্ট গণনা করা             │
│ ক্রয় পরিমাণ × পয়েন্ট রেট   │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ CUSTOMER LOYALTY আপডেট      │
│ - মোট পয়েন্ট যোগ            │
│ - স্তর পরীক্ষা               │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ স্তর আপগ্রেড চেক করা       │
│ - পয়েন্ট সীমা অতিক্রম?       │
│ - নতুন সুবিধা আনলক?         │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ LOYALTY PROGRAMS আপডেট      │
│ - স্তর ডেটাবেস সিঙ্ক         │
│ - সুবিধা নির্ধারণ            │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ NOTIFICATIONS পাঠান          │
│ ✅ পয়েন্ট আপডেট             │
│ ✅ স্তর পরিবর্তন             │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ Dashboard আপডেট             │
│ ✅ আনুগত্য মেট্রিক্স          │
│ ✅ নতুন সদস্য                 │
│ ✅ স্তর বৃদ্ধি                │
└──────────────────────────────┘
```

---

### 5️⃣ অনলাইন অর্ডার থেকে ডেলিভারি

```
┌────────────────────────────────┐
│  অনলাইন গ্রাহক অর্ডার করে      │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ PRODUCTS চেক করা              │
│ - প্রাপ্যতা যাচাই            │
│ - মূল্য গণনা                 │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ INVENTORY রিজার্ভেশন          │
│ - স্টক সংরক্ষিত              │
│ - পরিমাণ হ্রাস                │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ ONLINE ORDERS রেকর্ড তৈরি     │
│ - অর্ডার বিবরণ সংরক্ষণ       │
│ - গ্রাহক তথ্য                │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ পেমেন্ট প্রসেসিং              │
│ - পেমেন্ট গেটওয়ে যোগাযোগ    │
│ - নিশ্চিতকরণ অপেক্ষা         │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ ORDER NOTIFICATIONS পাঠান      │
│ - গ্রাহক: নিশ্চিতকরণ         │
│ - স্টোর: প্যাকিং তালিকা      │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ স্টেটাস আপডেট লুপ            │
│ - প্রস্তুতি                   │
│ - শিপমেন্ট                   │
│ - ডেলিভারি                   │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ SALES রেকর্ড আপডেট          │
│ - সম্পূর্ণ লেনদেন           │
│ - রাজস্ব স্বীকৃতি           │
└──────────────┬─────────────────┘
               │
               ▼
┌────────────────────────────────┐
│ Dashboard আপডেট              │
│ ✅ অনলাইন বিক্রয়           │
│ ✅ ডেলিভারি হার            │
│ ✅ গ্রাহক সন্তুষ্টি          │
└────────────────────────────────┘
```

---

## 📊 রিয়েল-টাইম ডেটা সিঙ্ক্রোনাইজেশন

```
                ┌─────────────────┐
                │  CONVEX CLOUD   │
                │  (Backend DB)   │
                └────────┬────────┘
                         │
         ┌───────────────┼───────────────┐
         │               │               │
         ▼               ▼               ▼
    ┌────────┐      ┌────────┐      ┌────────┐
    │ Product │      │  Sales  │      │ Customers│
    │ Data    │      │ Records │      │ Profiles │
    └────┬───┘      └────┬───┘      └────┬───┘
         │               │               │
         └───────────────┼───────────────┘
                         │
                    Convex Query
                         │
         ┌───────────────┼───────────────┐
         │               │               │
         ▼               ▼               ▼
    ┌──────────┐  ┌──────────┐  ┌──────────┐
    │ POS      │  │ Inventory│  │ Dashboard│
    │ Component│  │Component │  │Component │
    └──────────┘  └──────────┘  └──────────┘
         │               │               │
         └───────────────┼───────────────┘
                         │
                  useQuery Hook
                         │
                   WebSocket
                   (Real-time)
                         │
                    Browser UI
```

---

## 🔒 ডেটা নিরাপত্তা প্রবাহ

```
┌────────────────────────┐
│  ব্যবহারকারী লগইন    │
└──────────┬─────────────┘
           │
           ▼
┌────────────────────────┐
│ JWT টোকেন তৈরি       │
│ (JWT_PRIVATE_KEY সাইন)|
└──────────┬─────────────┘
           │
           ▼
┌────────────────────────┐
│ টোকেন স্থানীয় সংরক্ষণ│
└──────────┬─────────────┘
           │
           ▼
┌────────────────────────┐
│ প্রতিটি অনুরোধে পাঠান │
└──────────┬─────────────┘
           │
           ▼
┌────────────────────────┐
│ Convex যাচাই করা    │
│ (JWKS দিয়ে)        │
└──────────┬─────────────┘
           │
           ▼
┌────────────────────────┐
│ getAuthUserId() পান  │
└──────────┬─────────────┘
           │
           ▼
┌────────────────────────┐
│ ডাটা অ্যাক্সেস নিয়ন্ত্রণ │
└──────────┬─────────────┘
           │
           ▼
┌────────────────────────┐
│ ব্যবহারকারী-নির্দিষ্ট    │
│ ডাটা ফেরত            │
└────────────────────────┘
```

---

**রিয়েল-টাইম ডেটা ফ্লো সম্পূর্ণভাবে সংযুক্ত এবং স্বয়ংক্রিয়** ✅